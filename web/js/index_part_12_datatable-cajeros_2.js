(function(){$(document).ready(function(){var table=$("#cajeros").DataTable({order:[[0,"desc"]],language:{sProcessing:'<i class="fa fa-spinner fa-spin" aria-hidden="true"></i> Buscando cierres...',sLengthMenu:"Mostrar _MENU_ cierres",sZeroRecords:"No se encontraron cierres",sEmptyTable:"<span class='text-danger'><h4 style='margin-top: 0px; margin-bottom: 0px'>No hay cierres filtrados</h4></span>",sInfo:"Mostrando cierres del _START_ al _END_ de un total de _TOTAL_ cierres",sInfoEmpty:"Mostrando cierres del 0 al 0 de un total de 0 cierres",sInfoFiltered:"(filtrado de un total de _MAX_ cierres)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando cierres..",oPaginate:{sFirst:"Primero",sLast:"Ãšltimo",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}},responsive:true,processing:true,ajax:{url:"/api/cuadrecajero",type:"GET"},columns:[{data:"id"},{data:"fecha"},{data:"punto"},{data:"cajero"},{data:"efectivo"},{data:"motivo"},{orderable:false,searchable:false,data:null,render:function(data,type,full,meta){var url="/cajero/tirilla/";var data=' data-id="'+full.id+'"';var a='<a "'+data+'" href="#modalEditar" class="verdetalle edit" onclick="onClickEditarTirilla(this);"><i class="btn btn-link glyphicon glyphicon-edit"></i></a>';a+="<a href='"+url+full.id+"' onclick='onClickImprimirTirilla(this);'><i class='btn btn-link glyphicon glyphicon-print'></i></a>";return a}}]})})})();function onClickImprimirTirilla(elemento){var widthVentana=663;var heightVentana=525;var left=(screen.width-widthVentana)/2;var top=(screen.height-heightVentana)/2;var ventanaImpresion=window.open(elemento,"_blank","top="+top+",left="+left+",width="+widthVentana+",height="+heightVentana+",toolbar=no,directories=no,status=no,menubar=no, scrollbars=no,resizable=no");ventanaImpresion.focus();ventanaImpresion.print()}function onClickEditarTirilla(elemento){$("#modalEditar").modal("show");$.ajax({type:"GET",url:"/api/getcierrebyid",data:{id:$(elemento).data("id")},timeout:2e4,error:function(){console.error("Error")},beforeSend:function(){},success:function(data){$("#idModal").val(data.id);$("#idFecha").val(data.fecha);$("#ventregado").val(data.digitado);$("#punto").empty();$("#punto").append("<option value="+data.terminal.id+">"+data.terminal.name+"</option>");if(data.cierre_tarjeta.length>0){crearFilaTarjeta(data.cierre_tarjeta)}}})}function crearFilaTarjeta(registroArray){var tarjetasDescripcionesArray=new Array(20);tarjetasDescripcionesArray[3]="T.Debito";tarjetasDescripcionesArray[4]="T.Credito";tarjetasDescripcionesArray[16]="Comfaplus";tarjetasDescripcionesArray[18]="Sub.Especie";$(".tbodyTarjetas").empty();var html="";$.each(registroArray,function(key,registro){if(registro.cantidad>0&&registro.total>0){html+="<tr>";html+="<td style='display: none;'><input type='text' name='tarjetas["+key+"][id]' value='"+registro.id+"' class='form-control' /></td>";html+="<th><select name='tarjetas["+key+"][formapago]' class='form-control' >";html+="<option value='"+registro.forma_pago+"'>"+tarjetasDescripcionesArray[registro.forma_pago]+"</option>";html+="</select></th>";html+="<td><input type='number' name='tarjetas["+key+"][cantidad]' value='"+registro.cantidad+"' class='form-control'/></td>";html+="<td><input type='number' name='tarjetas["+key+"][total]' value='"+registro.total+"' class='form-control'/></td>";html+="</tr>"}});$(".tbodyTarjetas").append(html)}function confirmarEdicion(){var form=$("form.cierre").serialize();var key=$("#idModal").val();console.log(key);$.ajax({data:form,type:"post",url:"/api/ediciones/"+key,success:function(data,textStatus,jqXHR){console.log(data);$(".modal").modal("hide");$("#cajeros").DataTable().ajax.reload();if(data.status=="success"){$(".cajeros").removeClass("alert alert-danger").addClass("alert alert-success")}else{$(".cajeros").removeClass("alert alert-success").addClass("alert alert-danger")}$("#mensaje").html(data.mensaje)},error:function(data){console.log("Error de Conexion con el Servidor")}})}