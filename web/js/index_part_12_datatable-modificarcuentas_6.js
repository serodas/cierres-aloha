(function(){$(document).ready(function(){$("#datatable-modificarcuentas").hide();$("#btn-modificarcuentas").on("click",function(){$("#datatable-modificarcuentas").show();$("#modificarfacturas").hide();var date=$("#date").val();var table=$("#modificarcuentas").DataTable({searchDelay:1e3,language:{sProcessing:'<i class="fa fa-spinner fa-spin" aria-hidden="true"></i> Buscando cuentas...',sLengthMenu:"Mostrar _MENU_ cuentas",sZeroRecords:"No se encontraron cuentas",sEmptyTable:"<span class='text-danger'><h4 style='margin-top: 0px; margin-bottom: 0px'>No hay cuentas filtradas</h4></span>",sInfo:"Mostrando cuentas del _START_ al _END_ de un total de _TOTAL_ cuentas",sInfoEmpty:"Mostrando cuentas del 0 al 0 de un total de 0 cuentas",sInfoFiltered:"(filtrado de un total de _MAX_ cuentas)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando cuentas..",oPaginate:{sFirst:"Primero",sLast:"Ãšltimo",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}},responsive:true,processing:true,ajax:{url:"/api/consultacuentas/"+date,type:"GET",dataSrc:""},columns:[{data:"id"},{data:"terminal"},{data:"fecha"},{data:"empleado"},{data:"cuenta"},{data:"fpago"},{data:"valor"},{class:"details-control",orderable:false,data:null}],createdRow:function(row,ficha,index){var row=$(row);var td=$(row).children().eq(-1).html("");var botonEditar=$("<a data-toggle='modal' href='#modalEditar' class='editar'><i class='btn btn-link glyphicon glyphicon-edit'></i></a>");botonEditar.on("click",function(){$("#modalEditar").on("show.bs.modal",function(event){var modal=$(this);modal.find(".modal-body #idSec").val(ficha.id);modal.find(".modal-body #fecha").val(ficha.fecha);modal.find(".modal-body #empleado").val(ficha.empleado);modal.find(".modal-body #check").val(ficha.cuenta);modal.find(".modal-body #valor").val(ficha.valor);$.ajax({type:"GET",url:"/api/formasdepago/"+ficha.id,success:function(data){$.each(data,function(key,registro){for(var i=0;i<registro.length;i++){if(registro[i].id==data.typeid){$("#fpago").append("<option selected value="+registro[i].id+">"+registro[i].descripcion+"</option>")}else{$("#fpago").append("<option value="+registro[i].id+">"+registro[i].descripcion+"</option>")}}})},error:function(data){console.log("error de conexion con el servidor")}});modal.find(".modal-footer #si").on("click",function(){var form=$("form.frmEditar").serialize();var key=modal.find(".modal-body #idSec").val();console.log(form);$.ajax({data:form,type:"get",url:"/api/edicionesventas/"+key,success:function(data,textStatus,jqXHR){console.log(data);$(".modal").modal("hide");table.ajax.reload();if(data.status=="success"){$(".cuentas").removeClass("alert alert-danger").addClass("alert alert-success")}else{$(".cuentas").removeClass("alert alert-success").addClass("alert alert-danger")}$("#mensaje").html(data.mensaje)},error:function(data){console.log("Error de Conexion con el Servidor");console.log(form)}})})});var originalModal=$("#modalEditar").clone();$("#modalEditar").on("hidden.bs.modal",function(){$(this).remove();var myClone=originalModal.clone();$("body").append(myClone)})});td.append(botonEditar)}})})})})();